
# Hazard Products scripts

These scripts assume the following is already in place in
order to carry out the hazard analysis on a local laptop.

- An environment variable called $FEMA points to the topmost
directory of this hazard analysis.

- All python scripts used are stored in $FEMA/ptha_tools.

- The `geoclaw_output/all_runs_npy_files` exists and has been
copied to `$FEMA/redclaw_1106/all_runs_npy_files` on the laptop.

- The KL master probabilities have been copied to the file
`$FEMA/scenario_prb_wgts.txt` and the uniform master probabilities
have been copied to the file `$FEMA/scenario_prb_wgts_uniform.txt`.

- If needed for a particular scenario, the associated clustering
strategy formatted in a file called `clusters.txt` has been copied
to the appropriate subdirectory of $FEMA/scenarios_1106 after this
subdirectory has been created using the mkdir command.  This file
is used by the program `cluster_event_probs_make.py` to make three
lists to be manually input into `make_scenario.py`.  It is also used by
the program `pseudo_create.py` to create particular pseudo fine .npy 
files.

Overview of all the programs is given below.

- There are 2 utility programs that make directories for modified coarse
.npy files and for pseudo fine .npy files.  They are called
`make_coarse_mod_dirs.py` and `make_pseudo_dirs.py`.

- There are 3 programs to produce input data. The program
`coarse_fix.py` produces the modified coarse grid .npy files and
the program `pseudo_create.py` produces the pseudo fine grid .npy files.
For some scenarios, the program `cluster_event_probs_make.py` creates
three input lists used by the program `make_scenario.py`. (For other scenarios that
don't require the clustering, the program `make_scenario.py` automatically creates
these three input lists.)

- There are 2 programs that compare hmax data from the .npy data files found
in subdirectories of `$FEMA/redclaw_1106/all_runs_npy_files`. These can be the
original fine or coarse files or the modified coarse or pseudo fine files that were
placed there by `coarse_fix.py` or `pseudo_create.py`, respectively.
The program `compare_to.py` always
compares one data file to the corresponding coarse or to the corresponding fine
data for the same fixed grid, run number, and magnitude.
The program `compare_hmaxplots.py` always compares three data files to the
corresponding fine data for the same 2D-fixed grid, run number, and magnitude.
These programs can be run at any time in the process after the .npy data are available.

- There are 4 major programs called `make_scenario.py`, `hc_make_haz_run.py`,
`hc_plot_run.py`, and `hc_compare_run.py`. These programs make scenarios, produce hazard
curves for them, create flood files for particular exceedance values and generate
plots, and compare scenarios, respectively. (These flood files are .npy files used
by `hc_compare_run.py`.)

Now we describe each program in turn in the order used in the process.

##  Make all the directories for all the modified coarse grid runs

### make_coarse_mod_dirs.py 

This program simply makes the directories for storing all the
modified coarse grid data that will be generated by the program
`coarse_fix.py`.  See the documentation at the top of the program.

## Make all the modified coarse grid .npy data

### coarse_fix.py 

This program takes all 400 coarse grid .npy files and the coarse and
fine grid bathymetry files and produces the 400 modified coarse grid
.npy files.  See the documentation at the top of the program.

## Make all the pseudo run directories for a particular pseudo strategy

### make_pseudo_dirs.py 

This program simply makes the directories for storing all the
pseudo fine data that will be generated by the program `pseudo_create.py`
for a particular pseudo strategy.  See the documentation at the top of
the program.

## Make all the pseudo fine .npy data for a particular clustering strategy

### pseudo_create.py

This program takes all 400 modified coarse grid .npy files,
a budget of fine grid .npy files, and a clustering strategy
reflected in `clusters.txt` and produces all 400 pseudo fine
.npy files.  See the documentation at the top of the program.

## Compare a hmax .npy file to the corresponding coarse or fine .npy file

### `compare_to.py`

This program
compares one hmax .npy data file to the corresponding coarse or to the corresponding
fine data file for the same fixed grid, run number and magnitude.  All run numbers (and fixed grids)
for all magnitudes can be done in one execution of the program.  See the documentation
at the top of the program. 

## Compare three different hmax .npy files to the corresponding fine .npy file
for a 2D-fixed grid for the same run number and magnitude

### `compare_hmaxplots.py`

The program `compare_hmaxplots.py` always compares three data files to the
corresponding fine data for the same 2D-fixed grid, run number, and magnitude
to produce three rows of subplots for each comparison plot.
(For example, compare coarse to fine; compare modified coarse
to fine; compare a particular pseudo strategy to fine.) All run numbers for
a given magnitude can be done in one execution of the program. The program
will need to be edited to change the magnitude for other executions.
See the documentation at the top of the program.

## If needed, make three input lists for the program `make_scenario.py`

### `cluster_event_probs_make.py`

For the scenarios that require clustering, the file `clusters.txt`
previously stored in a particular scenario directory is used to
produce lists of run numbers, magnitudes for these run
numbers, and scenario probability weights to be used for each of
the run numbers.  See the documentation at the top of the program.

## Make a scenario to be considered for hazard product analysis

### `make_scenario.py`

The program makes a directory (if it doesn't already exist) and 
makes subdirectories where scenario results are to be stored.
The program leaves description files of the scenario in
this directory for use in the next steps of analysis.
See the documentation at the top of the program.

## Compute and save the hazardcurves.npy files for scenarios in scenarionames

### `hc_make_haz_run.py`

The program makes the .npy hazard curve files for all the fixed grids in each scenario
specified in the list scenarionames.
This program calls hazard_curves_calcv from `make_haz.py`.
See the documentation at the top of the program.

## Compute and save ZetaFloods.npy files and make plots for scenarios in scenarionames

### `hc_plot_run.py`

This program computes the floods for particular zeta exceedance levels for all fixed
grids in the specified scenarios. It makes contour and transects plots for
these scenarios.  The file ZetaFloods.npy is used by program `hc_compare_run.py`.
This program calls hazard_curves_2Dgrid_plot within `hazard_curves_2Dgrid_plot.py`
and hazard_curves_transect_plot within `hazard_curves_transect_plot.py`.
See the documentation at the top of the program.

## Compares scenarios in scenarionames and saves output in a comparison directory.

### hc_compare_run.py

This program
compares the fixed grids for the scenarios in scenarionames and saves output and
comparison plots in a comparison directory.  The user chooses the scenarios to
compare and sets up the comparison directory and respective subdirectories where
the comparison output is to be stored.
This program calls hazard_curves_2D_compare within the script
`hazard_curves_2Dgrid_compare.py` and hazard_curves_transect_compare within the
script `hazard_curves_transect_compare.py`.
See the documentation at the top of the program.

